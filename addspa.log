----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\users\amy.mason\staph_carriage\Programs\addspa.log
  log type:  text
 opened on:  19 Jul 2016, 19:42:09

. 
. noi di "Run by AMM on $S_DATE $S_TIME"
Run by AMM on 19 Jul 2016 19:42:09

. 
. 
. 
. noi di "INITIAL DISTANCES"
INITIAL DISTANCES

. 
. * compared to timepoint 0,2

. 
. 
. 
. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data.dta", clear

. 
. 
. 
. keep patid timepoint spatype

. 
. order patid timepoint spatype

. 
. replace spatype= subinstr(spatype, "contaminated", "",.)
(1 real change made)

. 
. bysort patid timepoint: assert _n==1

. 
. by patid: gen initialspa = spatype[1]
(3,405 missing values generated)

. 
. by patid: gen secondspa = spatype[2]
(4,085 missing values generated)

. 
. save temp, replace
file temp.dta saved

. 
. 
. 
. use temp, clear

. 
. split spatype, p(/)
variables created as string: 
spatype1  spatype2  spatype3  spatype4  spatype5

. 
. drop spatype

. 
. reshape long spatype, i(patid timepoint) j(current)
(note: j = 1 2 3 4 5)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     9039   ->   45195
Number of variables                   9   ->       6
j variable (5 values)                     ->   current
xij variables:
         spatype1 spatype2 ... spatype5   ->   spatype
-----------------------------------------------------------------------------

. 
. 
. 
. split initialspa, p(/)
variables created as string: 
initialspa1  initialspa2  initialspa3  initialspa4  initialspa5

. 
. split secondspa, p(/)
variables created as string: 
secondspa1  secondspa2  secondspa3  secondspa4  secondspa5

. 
. drop initialspa secondspa

. 
. rename secondspa1 initialspa6

. 
. rename secondspa2 initialspa7

. 
. rename secondspa3 initialspa8

. 
. rename secondspa4 initialspa9

. 
. rename secondspa5 initialspa10

. 
. reshape long initialspa, i(patid timepoint current) j(start)
(note: j = 1 2 3 4 5 6 7 8 9 10)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    45195   ->  451950
Number of variables                  14   ->       6
j variable (10 values)                    ->   start
xij variables:
initialspa1 initialspa2 ... initialspa10  ->   initialspa
-----------------------------------------------------------------------------

. 
. 
. 
. rename spatype spatype1

. 
. rename initial spatype2

. 
. 
. 
. merge m:1 spatype1 spatype2 using "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP", update
(note: variable spatype2 was str5, now str6 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                       530,618
        from master                   450,981  (_merge==1)
        from using                     79,637  (_merge==2)

    matched                               969
        not updated                       969  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. drop if _merge==2
(79,637 observations deleted)

. 
. assert inlist(_merge,1,3)

. 
. 
. 
. rename _merge _merge1

. 
. rename dist dist1

. 
. rename spatype1 spatype_temp

. 
. rename spatype2 spatype1

. 
. rename spatype_temp spatype2

. 
. 
. 
. merge m:1 spatype1 spatype2 using "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP", update

    Result                           # of obs.
    -----------------------------------------
    not matched                       530,501
        from master                   450,876  (_merge==1)
        from using                     79,625  (_merge==2)

    matched                             1,074
        not updated                     1,074  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. drop if _merge==2
(79,625 observations deleted)

. 
. assert inlist(_merge,1,3)

. 
. 
. 
. assert dist==. if dist1!=.

. 
. assert dist1==. if dist!=.

. 
. 
. 
. gen masterdist = min(dist1, dist)
(449,907 missing values generated)

. 
. replace masterdist=0 if spatype1==spatype2
(365,150 real changes made)

. 
. replace masterdist=1000 if spatype1=="" & spatype2!=""
(37,236 real changes made)

. 
. replace masterdist=1000 if spatype2=="" & spatype1!=""
(47,256 real changes made)

. 
. 
. 
. **********************************************************

. 
. **** TEMP UNTIL COST  MATRIX UPDATED****

. 
. drop if masterdist ==. 
(265 observations deleted)

. 
. 
. 
. **********************************************************

. 
. keep patid timepoint masterdist current start spa*

. 
. sort patid timepoint current start

. 
. 
. 
. * first find minimum distance between each current spatype and the initial set 

. 
. by patid timepoint current: egen minCOST = min(masterdist)

. 
. 
. 
. * then find the maximum of these over the various current spatypes

. 
. by patid timepoint: egen maxCOST_init = max(minCOST)

. 
. 
. 
. keep patid timepoint maxCOST

. 
. duplicates drop

Duplicates in terms of all variables

(442,646 observations deleted)

. 
. 
. 
. save "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP_init", replace
file E:\users\amy.mason\staph_carriage\Datasets\spa_BURP_init.dta saved

. 
. 
. 
. ********************************************************************

. 
. * BURP costs for  previous spa types (compare to n-1, n-2)

. 
. 
. 
. noi di "PREVIOUS SWAB DISTANCES"
PREVIOUS SWAB DISTANCES

. 
. * compared to timepoint 0,2

. 
. 
. 
. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data.dta", clear

. 
. 
. 
. keep patid timepoint spatype

. 
. order patid timepoint spatype

. 
. replace spatype= subinstr(spatype, "contaminated", "",.)
(1 real change made)

. 
. bysort patid timepoint: assert _n==1

. 
. by patid: gen onebehindspa = spatype[_n-1] if _n>1
(4,884 missing values generated)

. 
. by patid: replace onebehindspa = spatype[1] if _n==1
(358 real changes made)

. 
. by patid: gen twobehingsspa =spatype[_n-2] if _n>2
(5,121 missing values generated)

. 
. by patid: replace twobehingsspa =spatype[2] if _n<=2
(620 real changes made)

. 
. save temp, replace
file temp.dta saved

. 
. 
. 
. use temp, clear

. 
. split spatype, p(/)
variables created as string: 
spatype1  spatype2  spatype3  spatype4  spatype5

. 
. drop spatype

. 
. reshape long spatype, i(patid timepoint) j(current)
(note: j = 1 2 3 4 5)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     9039   ->   45195
Number of variables                   9   ->       6
j variable (5 values)                     ->   current
xij variables:
         spatype1 spatype2 ... spatype5   ->   spatype
-----------------------------------------------------------------------------

. 
. 
. 
. split onebehindspa, p(/)
variables created as string: 
onebehinds~1  onebehinds~2  onebehinds~3  onebehinds~4  onebehinds~5

. 
. split twobehingsspa, p(/)
variables created as string: 
twobehings~1  twobehings~2  twobehings~3  twobehings~4  twobehings~5

. 
. drop onebehindspa twobehingsspa

. 
. rename twobehingsspa1 onebehindspa6

. 
. rename twobehingsspa2 onebehindspa7

. 
. rename twobehingsspa3 onebehindspa8

. 
. rename twobehingsspa4 onebehindspa9

. 
. rename twobehingsspa5 onebehindspa10

. 
. reshape long onebehindspa, i(patid timepoint current) j(start)
(note: j = 1 2 3 4 5 6 7 8 9 10)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                    45195   ->  451950
Number of variables                  14   ->       6
j variable (10 values)                    ->   start
xij variables:
onebehindspa1 onebehindspa2 ... onebehindspa10->onebehindspa
-----------------------------------------------------------------------------

. 
. 
. 
. rename spatype spatype1

. 
. rename onebehind spatype2

. 
. 
. 
. merge m:1 spatype1 spatype2 using "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP", update

    Result                           # of obs.
    -----------------------------------------
    not matched                       531,002
        from master                   451,409  (_merge==1)
        from using                     79,593  (_merge==2)

    matched                               541
        not updated                       541  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. drop if _merge==2
(79,593 observations deleted)

. 
. assert inlist(_merge,1,3)

. 
. 
. 
. rename _merge _merge1

. 
. rename dist dist1

. 
. rename spatype1 spatype_temp

. 
. rename spatype2 spatype1

. 
. rename spatype_temp spatype2

. 
. 
. 
. merge m:1 spatype1 spatype2 using "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP", update

    Result                           # of obs.
    -----------------------------------------
    not matched                       530,983
        from master                   451,382  (_merge==1)
        from using                     79,601  (_merge==2)

    matched                               568
        not updated                       568  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. drop if _merge==2
(79,601 observations deleted)

. 
. assert inlist(_merge,1,3)

. 
. 
. 
. assert dist==. if dist1!=.

. 
. assert dist1==. if dist!=.

. 
. 
. 
. gen masterdist = min(dist1, dist)
(450,841 missing values generated)

. 
. replace masterdist=0 if spatype1==spatype2
(374,908 real changes made)

. 
. replace masterdist=1000 if spatype1=="" & spatype2!=""
(37,247 real changes made)

. 
. replace masterdist=1000 if spatype2=="" & spatype1!=""
(38,572 real changes made)

. 
. 
. 
. **********************************************************

. 
. **** TEMP UNTIL COST  MATRIX UPDATED****

. 
. drop if masterdist ==. 
(114 observations deleted)

. 
. 
. 
. **********************************************************

. 
. keep patid timepoint masterdist current start 

. 
. sort patid timepoint current start

. 
. 
. 
. * first find minimum distance between each current spatype and the initial set 

. 
. by patid timepoint current: egen minCOST = min(masterdist)

. 
. 
. 
. * then find the maximum of these over the various current spatypes

. 
. by patid timepoint: egen maxCOST_prev = max(minCOST)

. 
. 
. 
. keep patid timepoint maxCOST

. 
. duplicates drop

Duplicates in terms of all variables

(442,797 observations deleted)

. 
. 
. 
. save "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP_prev", replace
file E:\users\amy.mason\staph_carriage\Datasets\spa_BURP_prev.dta saved

. 
. merge 1:1 patid timepoint using "E:\users\amy.mason\staph_carriage\Datasets\spa_BURP_init", update

    Result                           # of obs.
    -----------------------------------------
    not matched                             0

    matched                             9,039
        not updated                     9,039  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. assert _merge==3

. 
. drop _merge

. 
. 
. 
. merge 1:1 patid timepoint using "E:\users\amy.mason\staph_carriage\Datasets\clean_data.dta", update

    Result                           # of obs.
    -----------------------------------------
    not matched                             0

    matched                             9,039
        not updated                     9,039  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. assert _merge==3

. 
. drop _merge

. 
. 
. 
. save "E:\users\amy.mason\staph_carriage\Datasets\clean_data2.dta", replace
(note: file E:\users\amy.mason\staph_carriage\Datasets\clean_data2.dta not found)
file E:\users\amy.mason\staph_carriage\Datasets\clean_data2.dta saved

. 
. * add antibiotics to cleanswab data

. 
. 
. 
. set li 130

. 
. 
. 
. cap log close
