----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\users\amy.mason\staph_carriage\Programs\spatypes.log
  log type:  text
 opened on:  17 Oct 2016, 16:30:21

. noi di "Run by AMM on $S_DATE $S_TIME"
Run by AMM on 17 Oct 2016 16:30:21

. 
. ************
. 
. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data3.dta", clear

. 
. keep patid timepoint spatype Result BestDate

. 
. * allow ambiguity in discrepency between Result and spatyping
. * NOTE: ask Dai to follow these up
. gen carriage = "defpos" if inlist(Result, "MRSA", "MSSA") & spatype!=""
(4,674 missing values generated)

. replace carriage ="defneg" if Result=="No growth" & spatype==""
(4,544 real changes made)

. replace carriage = "conflict: missing spatype" if Result!="No growth" & spatype==""
variable carriage was str6 now str25
(99 real changes made)

. replace carriage = "conflict: incorrect Result/spa match" if Result=="No growth" & spatype!="" & !inlist(timepoint,0,2)
variable carriage was str25 now str36
(10 real changes made)

. replace carriage = "ambigeous start" if  Result=="No growth" & spatype!="" & inlist(timepoint,0,2)
(19 real changes made)

. replace carriage = "Result missing" if Result ==""
(3 real changes made)

. assert carriage!=""

. 
. gen pos = carriage=="defpos"

. gen neg = carriage== "defneg"

. sort patid timepoint

. by patid: gen confirmedneg = ( neg[_n]==1 & neg[_n+1]==1) & _n!=_N 

. 
. by patid: gen pos_so_far = sum(pos)

. by patid: gen neg_so_far = sum(confirmedneg)

. 
. * create carriage so far variable = ignore conflicts, unclear = initial ambiguous results
. 
. gen carriage_todate = "always" if neg_s == 0
(5,220 missing values generated)

. replace carriage_todate = "never" if pos_s ==0 
(2,562 real changes made)

. replace carriage_todate = "unclear" if neg_s==0& pos_s==0
variable carriage_todate was str6 now str7
(30 real changes made)

. replace carriage_todate = "varies" if neg_s!=0& pos_s!=0
(2,688 real changes made)

. 
. *
. 
. 
. * add missing due to time point
. noi di "missing due to lack of opportunity"
missing due to lack of opportunity

. 
. preserve

. keep patid timepoint carriage BestDate carriage_todate

. 
end of do-file

. keep patid timepoint carriage BestDate carriage_todate

. do "C:\Users\AMY~1.MAS\AppData\Local\Temp\9\STD06000000.tmp"

. 
. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data3.dta", clear

. 
. keep patid timepoint spatype Result BestDate

. 
. * allow ambiguity in discrepency between Result and spatyping
. * NOTE: ask Dai to follow these up
. gen carriage = "defpos" if inlist(Result, "MRSA", "MSSA") & spatype!=""
(4,674 missing values generated)

. replace carriage ="defneg" if Result=="No growth" & spatype==""
(4,544 real changes made)

. replace carriage = "conflict: missing spatype" if Result!="No growth" & spatype==""
variable carriage was str6 now str25
(99 real changes made)

. replace carriage = "conflict: incorrect Result/spa match" if Result=="No growth" & spatype!="" & !inlist(timepoint,0,2)
variable carriage was str25 now str36
(10 real changes made)

. replace carriage = "ambigeous start" if  Result=="No growth" & spatype!="" & inlist(timepoint,0,2)
(19 real changes made)

. replace carriage = "Result missing" if Result ==""
(3 real changes made)

. assert carriage!=""

. 
. gen pos = carriage=="defpos"

. gen neg = carriage== "defneg"

. sort patid timepoint

. by patid: gen confirmedneg = ( neg[_n]==1 & neg[_n+1]==1) & _n!=_N 

. 
. by patid: gen pos_so_far = sum(pos)

. by patid: gen neg_so_far = sum(confirmedneg)

. 
. * create carriage so far variable = ignore conflicts, unclear = initial ambiguous results
. 
. gen carriage_todate = "always" if neg_s == 0
(5,220 missing values generated)

. replace carriage_todate = "never" if pos_s ==0 
(2,562 real changes made)

. replace carriage_todate = "unclear" if neg_s==0& pos_s==0
variable carriage_todate was str6 now str7
(30 real changes made)

. replace carriage_todate = "varies" if neg_s!=0& pos_s!=0
(2,688 real changes made)

. 
. *
. 
. 
. * add missing due to time point
. noi di "missing due to lack of opportunity"
missing due to lack of opportunity

. 
. 
. keep patid timepoint carriage BestDate carriage_todate

. 
end of do-file

. do "C:\Users\AMY~1.MAS\AppData\Local\Temp\9\STD06000000.tmp"

. keep patid timepoint carriage BestDate carriage_todate

. * everyone's 76th timeperiod has passed, allowing for month grace period of processing. so for those who returned their 78th swa
> b, should be updated to timepoint 86 (last point on record)
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. by patid: gen seventysix_Date = BestDate[1]+ 76*30.44

. format seventysix %td

. assert seventysix < d(28/07/2016)

. drop seventysix

. 
. * no-one who hands in 76/74/72 AND has a 78 date after end of may, has not already handed in 78 
. by patid: gen seventyeight_Date = BestDate[1]+ 78*30.44

. format seventy %td

. gen nextnotyet = 1 if seventy>= d(28/07/2016) & inlist(last, 76, 74, 72)
(9,019 missing values generated)

. assert next==.

. drop seventy next 

. 
. *80
. by patid: gen eighty_Date = BestDate[1]+ 80*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty_Date>= d(29/07/2016) & inlist(last, 78, 76, 74)
(9,019 missing values generated)

. assert next==.

. drop eighty next last

. 
. * start of missing: 40 missing
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. by patid: gen eightytwo_Date = BestDate[1]+ 82*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty>= d(29/07/2016) & inlist(last, 80, 78, 76)
(9,008 missing values generated)

. expand next+1, gen(copy)
(9,008 missing counts ignored; observations not deleted)
(11 observations created)

. replace timepoint=82 if copy==1
(11 real changes made)

. replace carriage_todate = "stilltocome" if copy==1
variable carriage_todate was str7 now str11
(11 real changes made)

. drop copy eighty next last

. 
. * repeat for 84: 41 missing
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,509 missing values generated)

. by patid: gen eightyfour_Date = BestDate[1]+ 84*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 82, 80, 78)
(8,993 missing values generated)

. expand next+1, gen(copy)
(8,993 missing counts ignored; observations not deleted)
(37 observations created)

. replace timepoint=84 if copy==1
(37 real changes made)

. replace carriage_todate = "stilltocome" if copy==1
(26 real changes made)

. drop copy eighty next last

. 
. * repeat for 86: 47 missing
. 
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,546 missing values generated)

. by patid: gen eightysix_Date = BestDate[1]+ 86*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 80)
(9,026 missing values generated)

. expand next+1, gen(copy)
(9,026 missing counts ignored; observations not deleted)
(41 observations created)

. replace timepoint=86 if copy==1
(41 real changes made)

. replace carriage_todate = "stilltocome" if copy==1
(4 real changes made)

. drop copy eighty next last

. 
. * repeat for 88: 47 missing
. 
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,587 missing values generated)

. by patid: gen eighty8_Date = BestDate[1]+ 88*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 86)
(9,066 missing values generated)

. expand next+1, gen(copy)
(9,066 missing counts ignored; observations not deleted)
(42 observations created)

. replace timepoint=88 if copy==1
(42 real changes made)

. replace carriage_todate = "stilltocome" if copy==1
(1 real change made)

. drop copy eighty next last

. 
. 
. * repeat for 90: 47 missing
. 
. sort patid timepoint

. by patid: gen last= timepoint[_N] if _n==_N
(8,629 missing values generated)

. by patid: gen eighty90_Date = BestDate[1]+ 90*30.44

. format eighty %td

. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 88, 86)
(9,099 missing values generated)

. expand next+1, gen(copy)
(9,099 missing counts ignored; observations not deleted)
(51 observations created)

. replace timepoint=90 if copy==1
(51 real changes made)

. replace carriage_todate = "stilltocome" if copy==1
(9 real changes made)

. drop copy eighty next last

. 
end of do-file

. drop if timepoint < 68
(8,593 observations deleted)

. gen pos= carriage=="defpos"

. bysort patid: egen maxpos = max(pos)

. drop if maxpos==0
(337 observations deleted)

. tab patid

Participant |
         ID |      Freq.     Percent        Cum.
------------+-----------------------------------
        302 |         11        4.06        4.06
        366 |         11        4.06        8.12
        374 |         11        4.06       12.18
        412 |         12        4.43       16.61
        418 |         12        4.43       21.03
        420 |         12        4.43       25.46
        424 |         12        4.43       29.89
        450 |         12        4.43       34.32
        451 |          1        0.37       34.69
        454 |         12        4.43       39.11
        671 |         12        4.43       43.54
        993 |         12        4.43       47.97
       1212 |         12        4.43       52.40
       1218 |         12        4.43       56.83
       1219 |         12        4.43       61.25
       1231 |         12        4.43       65.68
       1233 |         12        4.43       70.11
       1244 |         12        4.43       74.54
       1274 |         11        4.06       78.60
       1281 |         10        3.69       82.29
       1295 |         10        3.69       85.98
       1307 |         12        4.43       90.41
       1332 |         12        4.43       94.83
       1359 |         12        4.43       99.26
       2083 |          2        0.74      100.00
------------+-----------------------------------
      Total |        271      100.00

. sort patid timepoint

. tab timepoint

  timepoint |      Freq.     Percent        Cum.
------------+-----------------------------------
         68 |         19        7.01        7.01
         70 |         24        8.86       15.87
         72 |         23        8.49       24.35
         74 |         22        8.12       32.47
         76 |         22        8.12       40.59
         78 |         23        8.49       49.08
         80 |         23        8.49       57.56
         82 |         23        8.49       66.05
         84 |         23        8.49       74.54
         86 |         23        8.49       83.03
         88 |         23        8.49       91.51
         90 |         23        8.49      100.00
------------+-----------------------------------
      Total |        271      100.00

. tab timepoint carriage_todate

           |         carriage_todate
 timepoint |    always  stillto..     varies |     Total
-----------+---------------------------------+----------
        68 |        10          0          9 |        19 
        70 |        13          0         11 |        24 
        72 |        13          0         10 |        23 
        74 |        11          0         11 |        22 
        76 |        12          0         10 |        22 
        78 |        12          0         11 |        23 
        80 |        12          0         11 |        23 
        82 |        10          1         12 |        23 
        84 |         6         12          5 |        23 
        86 |         6         13          4 |        23 
        88 |         6         14          3 |        23 
        90 |         0         22          1 |        23 
-----------+---------------------------------+----------
     Total |       111         62         98 |       271 


. drop pos maxpos

. gen pos= carriage_todate=="always"

. bysort patid: egen maxpos = max(pos)

. drop if maxpos==0
(128 observations deleted)

. tab patid

Participant |
         ID |      Freq.     Percent        Cum.
------------+-----------------------------------
        366 |         11        7.69        7.69
        374 |         11        7.69       15.38
        420 |         12        8.39       23.78
        424 |         12        8.39       32.17
        450 |         12        8.39       40.56
        451 |          1        0.70       41.26
        454 |         12        8.39       49.65
        671 |         12        8.39       58.04
       1212 |         12        8.39       66.43
       1231 |         12        8.39       74.83
       1233 |         12        8.39       83.22
       1281 |         10        6.99       90.21
       1307 |         12        8.39       98.60
       2083 |          2        1.40      100.00
------------+-----------------------------------
      Total |        143      100.00

. tab timepoint carriage_todate, m

           |         carriage_todate
 timepoint |    always  stillto..     varies |     Total
-----------+---------------------------------+----------
        68 |        10          0          0 |        10 
        70 |        13          0          0 |        13 
        72 |        13          0          0 |        13 
        74 |        11          0          0 |        11 
        76 |        12          0          0 |        12 
        78 |        12          0          0 |        12 
        80 |        12          0          0 |        12 
        82 |        10          1          1 |        12 
        84 |         6          5          1 |        12 
        86 |         6          5          1 |        12 
        88 |         6          5          1 |        12 
        90 |         0         12          0 |        12 
-----------+---------------------------------+----------
     Total |       111         28          4 |       143 


. list if carriage_todate=="varies"

     +------------------------------------------------------------------------------------+
     | patid   timepo~t    BestDate                    carriage   carri~te   pos   maxpos |
     |------------------------------------------------------------------------------------|
 18. |   374         82   12feb2016                      defneg     varies     0        1 |
 19. |   374         84   07apr2016                      defneg     varies     0        1 |
 20. |   374         86   13jun2016   conflict: missing spatype     varies     0        1 |
 21. |   374         88   11aug2016   conflict: missing spatype     varies     0        1 |
     +------------------------------------------------------------------------------------+

. 
. 
. 
. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data3.dta", clear

. 
. 
. 
. keep patid timepoint spatype Result BestDate

. 
. 
. 
. * allow ambiguity in discrepency between Result and spatyping

. 
. * NOTE: ask Dai to follow these up

. 
. gen carriage = "defpos" if inlist(Result, "MRSA", "MSSA") & spatype!=""
(4,674 missing values generated)

. 
. replace carriage ="defneg" if Result=="No growth" & spatype==""
(4,544 real changes made)

. 
. replace carriage = "conflict: missing spatype" if Result!="No growth" & spatype==""
variable carriage was str6 now str25
(99 real changes made)

. 
. replace carriage = "conflict: incorrect Result/spa match" if Result=="No growth" & spatype!="" & !inlist(timepoint,0,2)
variable carriage was str25 now str36
(10 real changes made)

. 
. replace carriage = "ambigeous start" if  Result=="No growth" & spatype!="" & inlist(timepoint,0,2)
(19 real changes made)

. 
. replace carriage = "Result missing" if Result ==""
(3 real changes made)

. 
. assert carriage!=""

. 
. 
. 
. gen pos = carriage=="defpos"

. 
. gen neg = carriage== "defneg"

. 
. sort patid timepoint

. 
. by patid: gen confirmedneg = ( neg[_n]==1 & neg[_n+1]==1) & _n!=_N 

. 
. 
. 
. by patid: gen pos_so_far = sum(pos)

. 
. by patid: gen neg_so_far = sum(confirmedneg)

. 
. 
. 
. * create carriage so far variable = ignore conflicts, unclear = initial ambiguous results

. 
. 
. 
. gen carriage_todate = "always" if neg_s == 0
(5,220 missing values generated)

. 
. replace carriage_todate = "never" if pos_s ==0 
(2,562 real changes made)

. 
. replace carriage_todate = "unclear" if neg_s==0& pos_s==0
variable carriage_todate was str6 now str7
(30 real changes made)

. 
. replace carriage_todate = "varies" if neg_s!=0& pos_s!=0
(2,688 real changes made)

. 
. 
. 
. *

. 
. 
. 
. 
. 
. * add missing due to time point

. 
. noi di "missing due to lack of opportunity"
missing due to lack of opportunity

. 
. 
. 
. 
. 
. keep patid timepoint carriage BestDate carriage_todate

. 
. * everyone's 76th timeperiod has passed, allowing for month grace period of processing. so for those who returned their 78th swa
> b, should be updated to timepoint 86 (last point on record)

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. 
. 
. by patid: gen seventysix_Date = BestDate[1]+ 76*30.44

. 
. format seventysix %td

. 
. assert seventysix < d(28/07/2016)

. 
. drop seventysix

. 
. 
. 
. * no-one who hands in 76/74/72 AND has a 78 date after end of may, has not already handed in 78 

. 
. by patid: gen seventyeight_Date = BestDate[1]+ 78*30.44

. 
. format seventy %td

. 
. gen nextnotyet = 1 if seventy>= d(28/07/2016) & inlist(last, 76, 74, 72)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop seventy next 

. 
. 
. 
. *80

. 
. by patid: gen eighty_Date = BestDate[1]+ 80*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty_Date>= d(29/07/2016) & inlist(last, 78, 76, 74)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop eighty next last

. 
. 
. 
. * start of missing: 40 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. by patid: gen eightytwo_Date = BestDate[1]+ 82*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(29/07/2016) & inlist(last, 80, 78, 76)
(9,008 missing values generated)

. 
. expand next+1, gen(copy)
(9,008 missing counts ignored; observations not deleted)
(11 observations created)

. 
. replace timepoint=82 if copy==1
(11 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
variable carriage_todate was str7 now str11
(11 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 84: 41 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,509 missing values generated)

. 
. by patid: gen eightyfour_Date = BestDate[1]+ 84*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 82, 80, 78)
(8,993 missing values generated)

. 
. expand next+1, gen(copy)
(8,993 missing counts ignored; observations not deleted)
(37 observations created)

. 
. replace timepoint=84 if copy==1
(37 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(26 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 86: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,546 missing values generated)

. 
. by patid: gen eightysix_Date = BestDate[1]+ 86*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 80)
(9,026 missing values generated)

. 
. expand next+1, gen(copy)
(9,026 missing counts ignored; observations not deleted)
(41 observations created)

. 
. replace timepoint=86 if copy==1
(41 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(4 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 88: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,587 missing values generated)

. 
. by patid: gen eighty8_Date = BestDate[1]+ 88*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 86)
(9,066 missing values generated)

. 
. expand next+1, gen(copy)
(9,066 missing counts ignored; observations not deleted)
(42 observations created)

. 
. replace timepoint=88 if copy==1
(42 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(1 real change made)

. 
. drop copy eighty next last

. 
. 
. 
. 
. 
. * repeat for 90: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,629 missing values generated)

. 
. by patid: gen eighty90_Date = BestDate[1]+ 90*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 88, 86)
(9,099 missing values generated)

. 
. expand next+1, gen(copy)
(9,099 missing counts ignored; observations not deleted)
(51 observations created)

. 
. replace timepoint=90 if copy==1
(51 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(9 real changes made)

. 
. drop copy eighty next last

. drop if timepoint <60
(8,427 observations deleted)

. keep if carriage_=="never"
(554 observations deleted)

. tab carriage

                            carriage |      Freq.     Percent        Cum.
-------------------------------------+-----------------------------------
conflict: incorrect Result/spa match |          1        0.45        0.45
                              defneg |        219       99.55      100.00
-------------------------------------+-----------------------------------
                               Total |        220      100.00

. tab patid

Participant |
         ID |      Freq.     Percent        Cum.
------------+-----------------------------------
       1211 |         12        5.45        5.45
       1214 |         12        5.45       10.91
       1217 |         11        5.00       15.91
       1223 |         11        5.00       20.91
       1226 |          5        2.27       23.18
       1229 |         12        5.45       28.64
       1246 |         12        5.45       34.09
       1247 |         12        5.45       39.55
       1251 |         12        5.45       45.00
       1277 |          8        3.64       48.64
       1284 |         10        4.55       53.18
       1324 |          3        1.36       54.55
       1328 |          8        3.64       58.18
       1330 |          1        0.45       58.64
       1331 |         12        5.45       64.09
       1334 |          1        0.45       64.55
       1338 |         12        5.45       70.00
       1382 |         11        5.00       75.00
       1385 |         11        5.00       80.00
       1386 |         11        5.00       85.00
       1392 |         11        5.00       90.00
       1395 |         11        5.00       95.00
       1400 |         11        5.00      100.00
------------+-----------------------------------
      Total |        220      100.00

. tab timepoint patid

           |                                           ParticipantID
 timepoint |      1211       1214       1217       1223       1226       1229       1246       1247       1251 |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
        60 |         1          1          1          1          0          1          1          1          1 |        20 
        62 |         1          1          1          1          0          1          1          1          1 |        18 
        64 |         1          1          1          1          1          1          1          1          1 |        20 
        66 |         0          0          0          1          0          1          1          1          1 |        15 
        68 |         1          1          1          0          1          1          1          1          1 |        18 
        70 |         1          1          1          1          0          1          1          1          1 |        19 
        72 |         1          1          1          1          1          1          1          1          1 |        20 
        74 |         1          1          1          1          0          1          1          1          1 |        18 
        76 |         1          1          1          1          1          1          1          1          1 |        19 
        78 |         1          1          1          1          0          1          1          1          1 |        19 
        80 |         1          1          1          1          0          1          1          1          1 |        19 
        82 |         1          1          1          1          1          1          1          1          1 |        13 
        84 |         1          1          0          0          0          0          0          0          0 |         2 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |        12         12         11         11          5         12         12         12         12 |       220 


           |                                           ParticipantID
 timepoint |      1277       1284       1324       1328       1330       1331       1334       1338       1382 |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
        60 |         1          0          1          0          1          1          1          1          1 |        20 
        62 |         0          1          1          0          0          1          0          1          1 |        18 
        64 |         1          0          1          1          0          1          0          1          1 |        20 
        66 |         0          1          0          1          0          1          0          1          1 |        15 
        68 |         1          1          0          0          0          1          0          1          1 |        18 
        70 |         1          1          0          1          0          1          0          1          1 |        19 
        72 |         1          1          0          1          0          1          0          1          1 |        20 
        74 |         0          1          0          1          0          1          0          1          1 |        18 
        76 |         1          1          0          0          0          1          0          1          1 |        19 
        78 |         1          1          0          1          0          1          0          1          1 |        19 
        80 |         1          1          0          1          0          1          0          1          1 |        19 
        82 |         0          1          0          1          0          1          0          1          0 |        13 
        84 |         0          0          0          0          0          0          0          0          0 |         2 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         8         10          3          8          1         12          1         12         11 |       220 


           |                     ParticipantID
 timepoint |      1385       1386       1392       1395       1400 |     Total
-----------+-------------------------------------------------------+----------
        60 |         1          1          1          1          1 |        20 
        62 |         1          1          1          1          1 |        18 
        64 |         1          1          1          1          1 |        20 
        66 |         1          1          1          1          1 |        15 
        68 |         1          1          1          1          1 |        18 
        70 |         1          1          1          1          1 |        19 
        72 |         1          1          1          1          1 |        20 
        74 |         1          1          1          1          1 |        18 
        76 |         1          1          1          1          1 |        19 
        78 |         1          1          1          1          1 |        19 
        80 |         1          1          1          1          1 |        19 
        82 |         0          0          0          0          0 |        13 
        84 |         0          0          0          0          0 |         2 
-----------+-------------------------------------------------------+----------
     Total |        11         11         11         11         11 |       220 


. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data3.dta", clear

. 
. 
. 
. keep patid timepoint spatype Result BestDate

. 
. 
. 
. * allow ambiguity in discrepency between Result and spatyping

. 
. * NOTE: ask Dai to follow these up

. 
. gen carriage = "defpos" if inlist(Result, "MRSA", "MSSA") & spatype!=""
(4,674 missing values generated)

. 
. replace carriage ="defneg" if Result=="No growth" & spatype==""
(4,544 real changes made)

. 
. replace carriage = "conflict: missing spatype" if Result!="No growth" & spatype==""
variable carriage was str6 now str25
(99 real changes made)

. 
. replace carriage = "conflict: incorrect Result/spa match" if Result=="No growth" & spatype!="" & !inlist(timepoint,0,2)
variable carriage was str25 now str36
(10 real changes made)

. 
. replace carriage = "ambigeous start" if  Result=="No growth" & spatype!="" & inlist(timepoint,0,2)
(19 real changes made)

. 
. replace carriage = "Result missing" if Result ==""
(3 real changes made)

. 
. assert carriage!=""

. 
. 
. 
. gen pos = carriage=="defpos"

. 
. gen neg = carriage== "defneg"

. 
. sort patid timepoint

. 
. by patid: gen confirmedneg = ( neg[_n]==1 & neg[_n+1]==1) & _n!=_N 

. 
. 
. 
. by patid: gen pos_so_far = sum(pos)

. 
. by patid: gen neg_so_far = sum(confirmedneg)

. 
. 
. 
. * create carriage so far variable = ignore conflicts, unclear = initial ambiguous results

. 
. 
. 
. gen carriage_todate = "always" if neg_s == 0
(5,220 missing values generated)

. 
. replace carriage_todate = "never" if pos_s ==0 
(2,562 real changes made)

. 
. replace carriage_todate = "unclear" if neg_s==0& pos_s==0
variable carriage_todate was str6 now str7
(30 real changes made)

. 
. replace carriage_todate = "varies" if neg_s!=0& pos_s!=0
(2,688 real changes made)

. 
. 
. 
. *

. 
. 
. 
. 
. 
. * add missing due to time point

. 
. noi di "missing due to lack of opportunity"
missing due to lack of opportunity

. 
. 
. 
. 
. 
. keep patid timepoint carriage BestDate carriage_todate

. 
. * everyone's 76th timeperiod has passed, allowing for month grace period of processing. so for those who returned their 78th swa
> b, should be updated to timepoint 86 (last point on record)

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. 
. 
. by patid: gen seventysix_Date = BestDate[1]+ 76*30.44

. 
. format seventysix %td

. 
. assert seventysix < d(28/07/2016)

. 
. drop seventysix

. 
. 
. 
. * no-one who hands in 76/74/72 AND has a 78 date after end of may, has not already handed in 78 

. 
. by patid: gen seventyeight_Date = BestDate[1]+ 78*30.44

. 
. format seventy %td

. 
. gen nextnotyet = 1 if seventy>= d(28/07/2016) & inlist(last, 76, 74, 72)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop seventy next 

. 
. 
. 
. *80

. 
. by patid: gen eighty_Date = BestDate[1]+ 80*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty_Date>= d(29/07/2016) & inlist(last, 78, 76, 74)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop eighty next last

. 
. 
. 
. * start of missing: 40 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. by patid: gen eightytwo_Date = BestDate[1]+ 82*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(29/07/2016) & inlist(last, 80, 78, 76)
(9,008 missing values generated)

. 
. expand next+1, gen(copy)
(9,008 missing counts ignored; observations not deleted)
(11 observations created)

. 
. replace timepoint=82 if copy==1
(11 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
variable carriage_todate was str7 now str11
(11 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 84: 41 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,509 missing values generated)

. 
. by patid: gen eightyfour_Date = BestDate[1]+ 84*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 82, 80, 78)
(8,993 missing values generated)

. 
. expand next+1, gen(copy)
(8,993 missing counts ignored; observations not deleted)
(37 observations created)

. 
. replace timepoint=84 if copy==1
(37 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(26 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 86: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,546 missing values generated)

. 
. by patid: gen eightysix_Date = BestDate[1]+ 86*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 80)
(9,026 missing values generated)

. 
. expand next+1, gen(copy)
(9,026 missing counts ignored; observations not deleted)
(41 observations created)

. 
. replace timepoint=86 if copy==1
(41 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(4 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 88: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,587 missing values generated)

. 
. by patid: gen eighty8_Date = BestDate[1]+ 88*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 86)
(9,066 missing values generated)

. 
. expand next+1, gen(copy)
(9,066 missing counts ignored; observations not deleted)
(42 observations created)

. 
. replace timepoint=88 if copy==1
(42 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(1 real change made)

. 
. drop copy eighty next last

. 
. 
. 
. 
. 
. * repeat for 90: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,629 missing values generated)

. 
. by patid: gen eighty90_Date = BestDate[1]+ 90*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 88, 86)
(9,099 missing values generated)

. 
. expand next+1, gen(copy)
(9,099 missing counts ignored; observations not deleted)
(51 observations created)

. 
. replace timepoint=90 if copy==1
(51 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(9 real changes made)

. 
. drop copy eighty next last

. tab timepoint carriage

           |                             carriage
 timepoint | Result ..  ambigeo..  conflic..  conflic..     defneg     defpos |     Total
-----------+------------------------------------------------------------------+----------
         0 |         0         10          0          0        175        336 |       521 
         2 |         0          9          0          0        203        281 |       493 
         4 |         0          0          1          0        212        271 |       484 
         6 |         0          0          0          0        217        263 |       480 
         8 |         0          0          0          0        213        251 |       464 
        10 |         0          0          0          1        197        245 |       443 
        12 |         0          0          0          0        222        231 |       453 
        14 |         0          0          0          0        214        222 |       436 
        16 |         0          0          1          0        213        224 |       438 
        18 |         0          0          1          0        217        221 |       439 
        20 |         0          0          1          0        216        212 |       429 
        22 |         0          0          0          0        195        218 |       413 
        24 |         0          0          1          0        205        220 |       426 
        26 |         0          0          1          0        132         91 |       224 
        28 |         0          0          0          0        127         87 |       214 
        30 |         0          0          0          0        126         94 |       220 
        32 |         0          0          0          0        128         84 |       212 
        34 |         0          0          0          0        120         87 |       207 
        36 |         0          0          0          0        116         91 |       207 
        38 |         0          0          0          0        115         82 |       197 
        40 |         0          0          0          0        113         85 |       198 
        42 |         0          0          0          0        117         83 |       200 
        44 |         0          0          1          3        125         68 |       197 
        46 |         0          0          1          0        119         71 |       191 
        48 |         1          0          0          0        107         76 |       184 
        50 |         0          0          0          0          3          5 |         8 
        52 |         0          0          0          0          0          2 |         2 
        54 |         0          0          0          0          2          0 |         2 
        56 |         1          0          0          0         15          2 |        18 
        58 |         0          0          1          0         17          9 |        27 
        60 |         0          0          0          0         27         13 |        40 
        62 |         0          0          1          0         26         10 |        37 
        64 |         0          0          0          0         31         18 |        49 
        66 |         0          0          0          0         25         15 |        40 
        68 |         1          0          0          0         28         16 |        45 
        70 |         0          0          0          0         32         20 |        52 
        72 |         0          0          0          2         33         16 |        51 
        74 |         0          0          0         10         30          9 |        49 
        76 |         0          0          0         13         29          8 |        50 
        78 |         0          0          0         11         32          8 |        51 
        80 |         0          0          0         18         33          0 |        51 
        82 |         0          0          0         18         33          0 |        51 
        84 |         0          0          0         19         33          0 |        52 
        86 |         0          0          0         18         34          0 |        52 
        88 |         0          0          0         18         34          0 |        52 
        90 |         0          0          0         18         34          0 |        52 
-----------+------------------------------------------------------------------+----------
     Total |         3         19         10        149      4,675      4,345 |     9,201 


. tab timepoint carriage_

           |                    carriage_todate
 timepoint |    always      never  stillto..    unclear     varies |     Total
-----------+-------------------------------------------------------+----------
         0 |       336        161          0         24          0 |       521 
         2 |       298        153          0          4         38 |       493 
         4 |       266        153          0          1         64 |       484 
         6 |       255        143          0          1         81 |       480 
         8 |       238        132          0          0         94 |       464 
        10 |       222        120          0          0        101 |       443 
        12 |       210        122          0          0        121 |       453 
        14 |       195        111          0          0        130 |       436 
        16 |       187        110          0          0        141 |       438 
        18 |       188        108          0          0        143 |       439 
        20 |       177        100          0          0        152 |       429 
        22 |       173         94          0          0        146 |       413 
        24 |       177         94          0          0        155 |       426 
        26 |        75         75          0          0         74 |       224 
        28 |        64         70          0          0         80 |       214 
        30 |        65         68          0          0         87 |       220 
        32 |        59         62          0          0         91 |       212 
        34 |        57         58          0          0         92 |       207 
        36 |        58         59          0          0         90 |       207 
        38 |        55         52          0          0         90 |       197 
        40 |        54         50          0          0         94 |       198 
        42 |        55         50          0          0         95 |       200 
        44 |        52         49          0          0         96 |       197 
        46 |        50         46          0          0         95 |       191 
        48 |        49         43          0          0         92 |       184 
        50 |         2          2          0          0          4 |         8 
        52 |         0          0          0          0          2 |         2 
        54 |         0          2          0          0          0 |         2 
        56 |         2         11          0          0          5 |        18 
        58 |         3         14          0          0         10 |        27 
        60 |        10         20          0          0         10 |        40 
        62 |         4         18          0          0         15 |        37 
        64 |        13         20          0          0         16 |        49 
        66 |         9         15          0          0         16 |        40 
        68 |        10         18          0          0         17 |        45 
        70 |        13         19          0          0         20 |        52 
        72 |        13         20          0          0         18 |        51 
        74 |        11         18          0          0         20 |        49 
        76 |        12         19          0          0         19 |        50 
        78 |        12         19          0          0         20 |        51 
        80 |        12         19          0          0         20 |        51 
        82 |        10         13         11          0         17 |        51 
        84 |         6          2         37          0          7 |        52 
        86 |         6          0         41          0          5 |        52 
        88 |         6          0         42          0          4 |        52 
        90 |         0          0         51          0          1 |        52 
-----------+-------------------------------------------------------+----------
     Total |     3,769      2,532        182         30      2,688 |     9,201 


. drop if timepoint <72
(8,690 observations deleted)

. gen neg = carriage_todate=="never"

. bysort patid: egen negmax= max(neg)

. drop if negmax==0
(316 observations deleted)

. tab carriage_to_date
variable carriage_to_date not found
r(111);

. tab carriage_todate

carriage_to |
       date |      Freq.     Percent        Cum.
------------+-----------------------------------
      never |        110       56.41       56.41
stilltocome |         85       43.59      100.00
------------+-----------------------------------
      Total |        195      100.00

. sort patid timepoint

. list patid

     +-------+
     | patid |
     |-------|
  1. |  1211 |
  2. |  1211 |
  3. |  1211 |
  4. |  1211 |
  5. |  1211 |
     |-------|
  6. |  1211 |
  7. |  1211 |
  8. |  1211 |
  9. |  1211 |
 10. |  1211 |
     |-------|
 11. |  1214 |
 12. |  1214 |
 13. |  1214 |
 14. |  1214 |
 15. |  1214 |
     |-------|
 16. |  1214 |
 17. |  1214 |
 18. |  1214 |
 19. |  1214 |
 20. |  1214 |
     |-------|
 21. |  1217 |
 22. |  1217 |
 23. |  1217 |
 24. |  1217 |
 25. |  1217 |
     |-------|
 26. |  1217 |
 27. |  1217 |
 28. |  1217 |
 29. |  1217 |
 30. |  1217 |
     |-------|
 31. |  1223 |
 32. |  1223 |
 33. |  1223 |
 34. |  1223 |
 35. |  1223 |
     |-------|
 36. |  1223 |
 37. |  1223 |
 38. |  1223 |
 39. |  1223 |
 40. |  1223 |
     |-------|
 41. |  1226 |
 42. |  1226 |
 43. |  1226 |
 44. |  1226 |
 45. |  1226 |
     |-------|
 46. |  1226 |
 47. |  1226 |
 48. |  1229 |
 49. |  1229 |
 50. |  1229 |
     |-------|
 51. |  1229 |
 52. |  1229 |
 53. |  1229 |
 54. |  1229 |
 55. |  1229 |
     |-------|
 56. |  1229 |
 57. |  1229 |
 58. |  1246 |
 59. |  1246 |
 60. |  1246 |
     |-------|
 61. |  1246 |
 62. |  1246 |
 63. |  1246 |
 64. |  1246 |
 65. |  1246 |
     |-------|
 66. |  1246 |
 67. |  1246 |
 68. |  1247 |
 69. |  1247 |
 70. |  1247 |
     |-------|
 71. |  1247 |
 72. |  1247 |
 73. |  1247 |
 74. |  1247 |
 75. |  1247 |
     |-------|
 76. |  1247 |
 77. |  1247 |
 78. |  1251 |
 79. |  1251 |
 80. |  1251 |
     |-------|
 81. |  1251 |
 82. |  1251 |
 83. |  1251 |
 84. |  1251 |
 85. |  1251 |
     |-------|
 86. |  1251 |
 87. |  1251 |
 88. |  1277 |
 89. |  1277 |
 90. |  1277 |
     |-------|
 91. |  1277 |
 92. |  1277 |
 93. |  1277 |
 94. |  1277 |
 95. |  1277 |
     |-------|
 96. |  1277 |
 97. |  1284 |
 98. |  1284 |
 99. |  1284 |
100. |  1284 |
     |-------|
101. |  1284 |
102. |  1284 |
103. |  1284 |
104. |  1284 |
105. |  1284 |
     |-------|
106. |  1284 |
107. |  1328 |
108. |  1328 |
109. |  1328 |
110. |  1328 |
     |-------|
111. |  1328 |
112. |  1328 |
113. |  1328 |
114. |  1328 |
115. |  1328 |
     |-------|
116. |  1331 |
117. |  1331 |
118. |  1331 |
119. |  1331 |
120. |  1331 |
     |-------|
121. |  1331 |
122. |  1331 |
123. |  1331 |
124. |  1331 |
125. |  1331 |
     |-------|
126. |  1338 |
127. |  1338 |
128. |  1338 |
129. |  1338 |
130. |  1338 |
     |-------|
131. |  1338 |
132. |  1338 |
133. |  1338 |
134. |  1338 |
135. |  1338 |
     |-------|
136. |  1382 |
137. |  1382 |
138. |  1382 |
139. |  1382 |
140. |  1382 |
     |-------|
141. |  1382 |
142. |  1382 |
143. |  1382 |
144. |  1382 |
145. |  1382 |
     |-------|
146. |  1385 |
147. |  1385 |
148. |  1385 |
149. |  1385 |
150. |  1385 |
     |-------|
151. |  1385 |
152. |  1385 |
153. |  1385 |
154. |  1385 |
155. |  1385 |
     |-------|
156. |  1386 |
157. |  1386 |
158. |  1386 |
159. |  1386 |
160. |  1386 |
     |-------|
161. |  1386 |
162. |  1386 |
163. |  1386 |
164. |  1386 |
165. |  1386 |
     |-------|
166. |  1392 |
167. |  1392 |
168. |  1392 |
169. |  1392 |
170. |  1392 |
     |-------|
171. |  1392 |
172. |  1392 |
173. |  1392 |
174. |  1392 |
175. |  1392 |
     |-------|
176. |  1395 |
177. |  1395 |
178. |  1395 |
179. |  1395 |
180. |  1395 |
     |-------|
181. |  1395 |
182. |  1395 |
183. |  1395 |
184. |  1395 |
185. |  1395 |
     |-------|
186. |  1400 |
187. |  1400 |
188. |  1400 |
189. |  1400 |
190. |  1400 |
     |-------|
191. |  1400 |
192. |  1400 |
193. |  1400 |
194. |  1400 |
195. |  1400 |
     +-------+

. tab patid

Participant |
         ID |      Freq.     Percent        Cum.
------------+-----------------------------------
       1211 |         10        5.13        5.13
       1214 |         10        5.13       10.26
       1217 |         10        5.13       15.38
       1223 |         10        5.13       20.51
       1226 |          7        3.59       24.10
       1229 |         10        5.13       29.23
       1246 |         10        5.13       34.36
       1247 |         10        5.13       39.49
       1251 |         10        5.13       44.62
       1277 |          9        4.62       49.23
       1284 |         10        5.13       54.36
       1328 |          9        4.62       58.97
       1331 |         10        5.13       64.10
       1338 |         10        5.13       69.23
       1382 |         10        5.13       74.36
       1385 |         10        5.13       79.49
       1386 |         10        5.13       84.62
       1392 |         10        5.13       89.74
       1395 |         10        5.13       94.87
       1400 |         10        5.13      100.00
------------+-----------------------------------
      Total |        195      100.00

. use "E:\users\amy.mason\staph_carriage\Datasets\clean_data3.dta", clear

. 
. 
. 
. keep patid timepoint spatype Result BestDate

. 
. 
. 
. * allow ambiguity in discrepency between Result and spatyping

. 
. * NOTE: ask Dai to follow these up

. 
. gen carriage = "defpos" if inlist(Result, "MRSA", "MSSA") & spatype!=""
(4,674 missing values generated)

. 
. replace carriage ="defneg" if Result=="No growth" & spatype==""
(4,544 real changes made)

. 
. replace carriage = "conflict: missing spatype" if Result!="No growth" & spatype==""
variable carriage was str6 now str25
(99 real changes made)

. 
. replace carriage = "conflict: incorrect Result/spa match" if Result=="No growth" & spatype!="" & !inlist(timepoint,0,2)
variable carriage was str25 now str36
(10 real changes made)

. 
. replace carriage = "ambigeous start" if  Result=="No growth" & spatype!="" & inlist(timepoint,0,2)
(19 real changes made)

. 
. replace carriage = "Result missing" if Result ==""
(3 real changes made)

. 
. assert carriage!=""

. 
. 
. 
. gen pos = carriage=="defpos"

. 
. gen neg = carriage== "defneg"

. 
. sort patid timepoint

. 
. by patid: gen confirmedneg = ( neg[_n]==1 & neg[_n+1]==1) & _n!=_N 

. 
. 
. 
. by patid: gen pos_so_far = sum(pos)

. 
. by patid: gen neg_so_far = sum(confirmedneg)

. 
. 
. 
. * create carriage so far variable = ignore conflicts, unclear = initial ambiguous results

. 
. 
. 
. gen carriage_todate = "always" if neg_s == 0
(5,220 missing values generated)

. 
. replace carriage_todate = "never" if pos_s ==0 
(2,562 real changes made)

. 
. replace carriage_todate = "unclear" if neg_s==0& pos_s==0
variable carriage_todate was str6 now str7
(30 real changes made)

. 
. replace carriage_todate = "varies" if neg_s!=0& pos_s!=0
(2,688 real changes made)

. 
. 
. 
. *

. 
. 
. 
. 
. 
. * add missing due to time point

. 
. noi di "missing due to lack of opportunity"
missing due to lack of opportunity

. 
. 
. 
. 
. 
. keep patid timepoint carriage BestDate carriage_todate

. 
. * everyone's 76th timeperiod has passed, allowing for month grace period of processing. so for those who returned their 78th swa
> b, should be updated to timepoint 86 (last point on record)

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. 
. 
. by patid: gen seventysix_Date = BestDate[1]+ 76*30.44

. 
. format seventysix %td

. 
. assert seventysix < d(28/07/2016)

. 
. drop seventysix

. 
. 
. 
. * no-one who hands in 76/74/72 AND has a 78 date after end of may, has not already handed in 78 

. 
. by patid: gen seventyeight_Date = BestDate[1]+ 78*30.44

. 
. format seventy %td

. 
. gen nextnotyet = 1 if seventy>= d(28/07/2016) & inlist(last, 76, 74, 72)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop seventy next 

. 
. 
. 
. *80

. 
. by patid: gen eighty_Date = BestDate[1]+ 80*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty_Date>= d(29/07/2016) & inlist(last, 78, 76, 74)
(9,019 missing values generated)

. 
. assert next==.

. 
. drop eighty next last

. 
. 
. 
. * start of missing: 40 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,498 missing values generated)

. 
. by patid: gen eightytwo_Date = BestDate[1]+ 82*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(29/07/2016) & inlist(last, 80, 78, 76)
(9,008 missing values generated)

. 
. expand next+1, gen(copy)
(9,008 missing counts ignored; observations not deleted)
(11 observations created)

. 
. replace timepoint=82 if copy==1
(11 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
variable carriage_todate was str7 now str11
(11 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 84: 41 missing

. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,509 missing values generated)

. 
. by patid: gen eightyfour_Date = BestDate[1]+ 84*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 82, 80, 78)
(8,993 missing values generated)

. 
. expand next+1, gen(copy)
(8,993 missing counts ignored; observations not deleted)
(37 observations created)

. 
. replace timepoint=84 if copy==1
(37 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(26 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 86: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,546 missing values generated)

. 
. by patid: gen eightysix_Date = BestDate[1]+ 86*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 80)
(9,026 missing values generated)

. 
. expand next+1, gen(copy)
(9,026 missing counts ignored; observations not deleted)
(41 observations created)

. 
. replace timepoint=86 if copy==1
(41 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(4 real changes made)

. 
. drop copy eighty next last

. 
. 
. 
. * repeat for 88: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,587 missing values generated)

. 
. by patid: gen eighty8_Date = BestDate[1]+ 88*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 82, 86)
(9,066 missing values generated)

. 
. expand next+1, gen(copy)
(9,066 missing counts ignored; observations not deleted)
(42 observations created)

. 
. replace timepoint=88 if copy==1
(42 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(1 real change made)

. 
. drop copy eighty next last

. 
. 
. 
. 
. 
. * repeat for 90: 47 missing

. 
. 
. 
. sort patid timepoint

. 
. by patid: gen last= timepoint[_N] if _n==_N
(8,629 missing values generated)

. 
. by patid: gen eighty90_Date = BestDate[1]+ 90*30.44

. 
. format eighty %td

. 
. gen nextnotyet = 1 if eighty>= d(28/07/2016) & inlist(last, 84, 88, 86)
(9,099 missing values generated)

. 
. expand next+1, gen(copy)
(9,099 missing counts ignored; observations not deleted)
(51 observations created)

. 
. replace timepoint=90 if copy==1
(51 real changes made)

. 
. replace carriage_todate = "stilltocome" if copy==1
(9 real changes made)

. 
. drop copy eighty next last

. gen neg = carriage_todate=="never" & timepoint>72

. bysort patid: egen negmax= max(neg)

. drop if negmax==0
(8,383 observations deleted)

. replace carriage=="" if carriage_=="stilltocome"
== invalid name
r(198);

. replace carriage="" if carriage_=="stilltocome"
(85 real changes made)

. tab patid carriage, m

Participan |                  carriage
       tID |            Result ..  conflic..     defneg |     Total
-----------+--------------------------------------------+----------
      1211 |         3          0          1         37 |        41 
      1214 |         3          0          0         37 |        40 
      1217 |         4          0          0         37 |        41 
      1223 |         4          0          0         37 |        41 
      1226 |         4          0          0         30 |        34 
      1229 |         4          0          0         39 |        43 
      1246 |         4          0          0         39 |        43 
      1247 |         4          0          0         38 |        42 
      1251 |         4          0          0         39 |        43 
      1277 |         5          0          0         33 |        38 
      1284 |         4          1          0         35 |        40 
      1328 |         4          0          0         34 |        38 
      1331 |         4          0          0         38 |        42 
      1338 |         4          0          0         38 |        42 
      1382 |         5          0          0         39 |        44 
      1385 |         5          0          0         39 |        44 
      1386 |         5          0          0         38 |        43 
      1392 |         5          0          0         36 |        41 
      1395 |         5          0          1         34 |        40 
      1400 |         5          0          0         33 |        38 
-----------+--------------------------------------------+----------
     Total |        85          1          2        730 |       818 


. cd "E:\users\amy.mason\staph_carriage\Programs"
E:\users\amy.mason\staph_carriage\Programs

. 
. run Clean_maindata.do
